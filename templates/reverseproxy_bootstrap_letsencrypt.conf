server {
    listen         {{ item.value.port.http | default(80) }};
    listen    [::]:{{ item.value.port.http | default(80) }};
    server_name {{ item.key }} {{ (item.value.additional_domains | default([])) | join(' ') }};

    location /.well-known/acme-challenge {
        alias /var/www/{{ item.key }}/.well-known/acme-challenge;
    }

## LOGGING
{% if item.value.log.syslog %}
    access_log syslog:server=unix:/dev/log,facility=local0,severity=info,nohostname {{ item.value.log.access_fmt }};
    error_log syslog:server=unix:/dev/log,facility=local0,severity=error,nohostname {{ item.value.log.error_fmt }};
{% else %}
    access_log /var/log/nginx/{{ item.key }}_access.log {{ item.value.log.access_fmt }};
    error_log /var/log/nginx/{{ item.key }}_error.log {{ item.value.log.error_fmt }};
{% endif %}
}
